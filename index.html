<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Booking App</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-utensils"></i> TableBook</h1>
            <p class="subtitle">Reserve your perfect dining experience</p>
        </div>
        
        <div id="auth-container">
            <!-- Login Form -->
            <div id="login-form">
                <h2>Welcome Back</h2>
                <div id="login-error" class="error-message hidden"></div>
                
                <div class="form-group">
                    <label for="email"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="email" placeholder="Enter your email">
                </div>
                
                <div class="form-group">
                    <label for="password"><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="password" placeholder="Enter your password">
                </div>
                
                <button onclick="loginUser()" id="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                
                <p style="text-align: center; margin-top: 20px; color: #636e72;">
                    Don't have an account? 
                    <a href="javascript:void(0)" onclick="showSignup()" style="color: #e17055;">Sign up here</a>
                </p>
            </div>
            
            <!-- Signup Form -->
            <div id="signup-form" class="hidden">
                <h2>Create Account</h2>
                <div id="signup-error" class="error-message hidden"></div>
                
                <div class="form-group">
                    <label for="signup-email"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="signup-email" placeholder="Enter your email">
                </div>
                
                <div class="form-group">
                    <label for="signup-password"><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="signup-password" placeholder="Create a password">
                </div>
                
                <div class="form-group">
                    <label for="signup-role"><i class="fas fa-user-tag"></i> I want to</label>
                    <select id="signup-role">
                        <option value="CLIENT">Book restaurants</option>
                        <option value="OWNER">List my restaurant</option>
                    </select>
                </div>
                
                <button onclick="signupUser()" id="signup-btn">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
                
                <p style="text-align: center; margin-top: 20px; color: #636e72;">
                    Already have an account? 
                    <a href="javascript:void(0)" onclick="showLogin()" style="color: #e17055;">Login here</a>
                </p>
            </div>
        </div>
    </div>

<script type="module">
    import { login, signup } from "./js/auth.js";
    
    window.loginUser = async () => {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const errorDiv = document.getElementById('login-error');
        const btn = document.getElementById('login-btn');
        
        if (!email || !password) {
            errorDiv.textContent = "Please fill in all fields";
            errorDiv.classList.remove('hidden');
            return;
        }
        
        try {
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
            btn.disabled = true;
            
            const role = await login(email, password);
            
            if (role === "OWNER") {
                window.location.href = "owner.html";
            } else {
                window.location.href = "client.html";
            }
        } catch (error) {
            console.error("Login error:", error);
            errorDiv.textContent = error.message || "Login failed. Please check your credentials.";
            errorDiv.classList.remove('hidden');
        } finally {
            btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
            btn.disabled = false;
        }
    };
    
    window.signupUser = async () => {
        const email = document.getElementById('signup-email').value;
        const password = document.getElementById('signup-password').value;
        const role = document.getElementById('signup-role').value;
        const errorDiv = document.getElementById('signup-error');
        const btn = document.getElementById('signup-btn');
        
        if (!email || !password) {
            errorDiv.textContent = "Please fill in all fields";
            errorDiv.classList.remove('hidden');
            return;
        }
        
        if (password.length < 6) {
            errorDiv.textContent = "Password must be at least 6 characters";
            errorDiv.classList.remove('hidden');
            return;
        }
        
        try {
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating account...';
            btn.disabled = true;
            
            await signup(email, password, role);
            
            errorDiv.classList.add('hidden');
            document.getElementById('signup-error').innerHTML = 
                '<div class="success-message">Account created successfully! Redirecting to login...</div>';
            
            setTimeout(() => {
                showLogin();
            }, 2000);
        } catch (error) {
            console.error("Signup error:", error);
            errorDiv.textContent = error.message || "Signup failed. Please try again.";
            errorDiv.classList.remove('hidden');
        } finally {
            btn.innerHTML = '<i class="fas fa-user-plus"></i> Create Account';
            btn.disabled = false;
        }
    };
    
    window.showSignup = () => {
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('signup-form').classList.remove('hidden');
        document.getElementById('login-error').classList.add('hidden');
    };
    
    window.showLogin = () => {
        document.getElementById('signup-form').classList.add('hidden');
        document.getElementById('login-form').classList.remove('hidden');
        document.getElementById('signup-error').classList.add('hidden');
    };
    
    // Show login form by default
    document.addEventListener('DOMContentLoaded', () => {
        showLogin();
    });
</script>
</body>
</html>